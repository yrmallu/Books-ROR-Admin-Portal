<%= form_tag 'schools/delete_school' do %>
<div class="panel panel-default">
	<div class="panel-body"> 
		<div class="index_page_btns" data-no-turbolink>
			<%=link_to 'Import School List', import_list_schools_path, :class=>"btn btn-success btn-xs"%>
			<%=link_to 'Download Sample',"", :class=>"btn btn-success btn-xs download_sample", :"data-toggle" => "modal", :"data-target" => "#download_list_modal" %>
			
			<% if can? :create, :schools %> <%=link_to 'Add School', new_school_path, :class=>"btn btn-success btn-xs"%> <%end%>
			<%=submit_tag 'Delete', :class=>"btn btn-success btn-xs delete-school-list", :id=>'delete_element',:disabled => true, data: { confirm: 'Are you sure?' } %>
		</div>
		 
		<div class="table-responsive">
			<table class="table class_common_table" id="school_table">
	            <thead>
	                <tr>
	                	<th>Remove all &nbsp; <%= check_box_tag 'school_id[]', '', false, :class => "all-school" %></th>
	                    <th>School Code</th>
	                    <th>School Name</th>
	                    <th>District</th>
	                    <th>City</th>
						<th>State</th>
	                    <th>Country</th>
						<th>Actions</th>
	                </tr>
	            </thead>
	            <tbody>
					<% @schools.each do |school| %>
		                <tr class="odd gradeX">
		                  <td class=""><%= check_box_tag 'school_ids[]', school.id, false, :class => "check-box" %></td>	
		                  <td class=""><%= school.code %></td>
		                  <td class=""><%= school.name %></td>
		                  <td class=""><%= school.district %></td>
		                  <td class="center "><%= school.city %></td>
		                  <td class="center "><%= school.state %></td>
						  <td class="center "><%= school.country %></td>
						  <td data-no-turbolink>
						  	<% if can? :update, :schools %>
						    	<%= link_to '<i title="Edit School" class="fa fa-pencil"></i>'.html_safe, edit_school_path(school) %>  
						    <%end%>
					   	    <% if can? :destroy, :schools %> 
						      <%= link_to '<i title="Archive School" class="glyphicon glyphicon-trash"></i>'.html_safe, school, method: :delete, data: { confirm: 'Are you sure?' } %> 
					      	<%end%>
							<% if can? :create, :licenses %> 
							   <%= link_to '<i title="Add License" class="btg btg-lisence"></i>'.html_safe, new_license_path(:school_id=>school)%> 
							<%end%>
							<% if can? :read, :users %>
							    <%=link_to '<i title="School Admin List" class="btg btg-admin"></i>'.html_safe, users_path(:school_id=>school, :role_id=>@school_admin.id)%> 
							<%end%>
							<% if can? :read, :users %>
							    <%=link_to '<i title="Teacher List" class="btg btg-teacher"></i>'.html_safe, users_path(:school_id=>school, :role_id=>@teacher.id)%>
							<%end%>
							<% if can? :read, :users %>
							    <%=link_to '<i title="Student List" class="btg btg-student"></i>'.html_safe, users_path(:school_id=>school, :role_id=>@student.id)%> 
							<%end%>
							<% if can? :read, :classrooms %>
							    <%= link_to '<i title="Classroom List" class="btg btg-classroom"></i>'.html_safe, classrooms_path(:school_id=>school)%> 
						   <%end%>
						<% if can? :read, :licenses %> 
						    <button class="btn btn-primary btn-xs license_details" data-toggle="modal" data-target="#school_license_details" data-input='<%=school.id%>' >
						    License Details
						    </button>	
						<%end%>	
						   </td>
		                </tr>
					<% end %>
	        	</tbody>
	    	</table>
		</div>

		<div data-no-turbolink>
			<%= paginate @schools %>
		</div>	
	</div>	
</div>	  
<% end %>		  


<div class="modal fade" id="school_license_details" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">License Details</h4>
      </div>
      <div class="modal-body">
		  <div id="schoolwise_licenses_list"></div>
	  </div>
    </div>
  </div>
</div>	

<div class="modal fade" id="download_list_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" style="width:800px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Download Sample List</h4>
      </div>
      <div class="modal-body sample_list_links_div">
		  <div id="school_admin">
		  		<%=link_to 'Download Sample', download_school_list_schools_path(:format => :xls), :class=>"btn btn-success btn-xs"%>
		  		<%=link_to 'Download Sample', download_school_list_schools_path(:format => :csv), :class=>"btn btn-success btn-xs"%>
		  </div>
	  </div>
      <!-- <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Assign</button>
      </div> -->
    </div>
  </div>
</div>		

<script type="text/javascript">
	showHideMenu('li_school');
	
	$( ".license_details" ).click(function() {
	          jQuery.get("<%=url_for(:controller=>'schools',:action=>'get_schoolwise_license_list')%>",{ id : $(this).attr('data-input')},
	function(data) {
	         
	             if(data)
	              {
				   jQuery("#schoolwise_licenses_list").html(data);
	             }
	      });
	});	
</script>